<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>The Beginner's Guide to the UNIXverse</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">

        <!-- styles -->
        <link href="./assets/css/bootstrap.min.css" rel="stylesheet">
        <link href="./assets/css/bootswatch.min.css" rel="stylesheet">
        <link href="./assets/css/font-awesome.min.css" rel="stylesheet">
        <link href="./assets/css/shCore.css" rel="stylesheet">
        <link href="./assets/css/shThemeDefault.css" rel="stylesheet">
    </head>

    <body>
        <!-- navigation -->
        <div class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
              <a href="" class="navbar-brand">The Beginner's Guide to the UNIXverse</a>
              <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
            </div>
            <div class="navbar-collapse collapse" id="navbar-main">
              <ul class="nav navbar-nav">
                <li>
                  <a href="./">Home</a>
                </li>
                
                
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">Lessons <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li>
                          <a href="./intro.html">Introduction</a>
                        </li>
                        
                        <li>
                          <a href="./filters.html">UNIX Filters</a>
                        </li>
                        
                        <li>
                          <a href="./regex.html">Regular Expressions</a>
                        </li>
                        
                        <li class="active">
                          <a href="./scripts.html">Shell Scripting</a>
                        </li>
                                                
						<li>
						  <a href="./solutions.html">Solutions</a>
						</li>
                    </ul>
                </li>
                    
                <li>
                  <a href="./tips.html">Tips</a>
                </li>
              </ul>

              <ul class="nav navbar-nav navbar-right">
                <li><a href="http://compclub.com.au/" target="_blank">CompClub</a></li>
              </ul>

            </div>
            </div>
        </div>

        <!-- content -->
        <div class="container">
            <!-- hello everybody-->
            <div class="jumbotron" style="margin-top: 30px">
                <h1>
                    <span class="fa-stack">
                      <i class="fa fa-square fa-stack-2x"></i>
                      <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
                    </span>

                    Shell Scripting
                </h1>
            </div>
        
            <div>

                <div class="row">
                    <h3>Shell as an Interpreter</h3>
                    <hr>
                    <p>All of our interactions with the shell so far have been using a <em>command (program)</em> and passing it command line arguments. Usually taking the form of:</p>
                    <pre class="brush:bash">
Command Arg1 Arg2 Arg3 &lt; input &gt; output
                    </pre>
                    <p>We extended that functionality using our friendly little pipes, <code>|</code>, to direct one programs output into another's input. With this we were able to perform some complicated operations. Now we're going to extend our capabilities even further with <strong>Shell Scripting</strong>.
                </div>

                <div class="row">
                    <h3>Shell Scripts</h3>
                    <hr>
                    <p>Since this is a, though quite basic, programming language we'll start with the classic and over done:</p>
                    <h4>Hello World Script!</h4>
                    <pre class="brush:bash">
#!/bin/sh

echo Hello, World
                    </pre>
                    <p>Looking at this script you can see what it will most likely do when run. It will execute the command <code>echo</code> with the input text <em>Hello, World</em>. <br>
                    Now you'll probably be wondering what in the world does the first line of script mean or do? Very basically it tells the thing trying to run the script what <em>Interpreter</em> should be used to execute the code. In this case it is saying use <code>sh</code> which is one of the main shell interpreters. There's no need to know much more about it at this point beyond the facts that:</p>
                    <ul>
                        <li>You should include it as the first line of every shell script you write.</li>
                        <li>Pretty much any command you can run in the command line will work with the <code>sh</code> interpreter.</li>
                    </ul>
                    <p>Now we have the ability to write some basic shell scripts BUT we need a way to execute (run) them. So just before the next section create a file called <em>hello</em> and save the Hello, World program into it.</p>
                </div>

                <div class="row">
                    <h3>Running Shell Scripts</h3>
                    <hr>
                    <p>So before it was mentioned that <code>sh</code> is an interpreter that can read and execute shell scripts. One way we could run our script then would be to treat the script just like normal input from a file that we are going to give to a command, like every other filter we've been using so far. Like so:</p>
                    <pre class="brush:bash">
sh hello
                    </pre>
                    <p>This tells <code>sh</code> to take in the contents of <em>hello</em> and try to execute it. Now this sounds very similar to what that first line of our script is supposed to do. If we run our scripts using the above method we don't even need that first line but there is a better way to execute our scripts!</p>
                    <br>
                    <p>What we're going to do is turn our standard file that just contains some text into an executable, like a <em>.exe</em> on windows. To do this we need to change the <em>properties</em> of the file so that UNIX sees it as an executable file. To do this we use a program we haven't seen yet called <code>chmod</code>. To explain all about <code>chmod</code> and UNIX file permissions would take a while so I'll very quickly give you the three main permissions a file/folder can hold and how we add the executable permission to our scripts.</p>
                    <h4><code>chmod</code></h4>
                    Usage:
                    <pre class="brush:bash">
chmod permission file
                    </pre>
                    <ul>
                        <li>The three basic permissions you can give to a file are <strong>read</strong>, <strong>write</strong> and <strong>execute</strong>.</li>
                        <li>The <em>permission</em> section is where you put what type of permission you want to add or take away.</li>
                    </ul>
                    <p>Our usage will pretty much only consist of adding the executable permission to our scripts, to do this you do the following:</p>
                    <pre class="brush:bash">
chmod +x file
                    </pre>

                    <div class="row">
                        <h3>Input and Variables</h3>
                        <hr>
                        <p>Now we'll look at a script that does something crazy and amazing.</p>
                        <pre class="brush:bash">
#!/bin/sh

echo -n "Enter your name: "
read name
echo Hello, $name
                        </pre>
                        <p>This is where shell scripting starts to look a bit different from normal commands that you would use in a command prompt. The first <em>echo</em> line does as you would expect, just prints out the text (-n means it won't print a newline at the end of the line).</p>
                        <p>Though the next line has <code>read</code> and then <code>name</code>, <code>name</code> is our very creative name for a variable.</p>
                        <p>This is where your prior coding experience should help, you probably know what a variable is (if you don't just ask a helper) and you know that they store things. So if we want to read in someones name to our program we need to store it so we can then use it later, that's what our variable <code>name</code> does. The syntax for variable you'll pick up from just writing scripts but the general gist is when first put something in the variable you just type out what you want to call it such as <code>name</code>. Then whenever you want to use that variable again say to print it out with <code>echo</code> you just append a <em>$</em> to it.</p>
                        <p>Here's an example script that shows a bit about how variable can be used:</p>
                        <pre class="brush:bash">
read x     # read a value into variable x
y=John     # assign a value to variable y
echo $x    # display the value of variable x
z="$y $y"  # assign two copies of y to variable z
                        </pre>
                        <div class="alert alert-info">
                            Note: spaces matter, do not put spaces around the = symbol or your variables won't work.
                        </div>
                        <div class="row">
                            <div class="col-md-8">
                                <h4>A couple more useful notes on shell variables</h4>
                                <ul>
                                    <li>There's no need to declare shell variables. You simply use them.</li>
                                    <li>All variables have the type string.</li>
                                    <li>Note that <code>x=1</code> is equivalent to <code>x="1"</code></li>
                                </ul>
                            </div>
                            <div class="col-md-4">
                                <pre class="brush:bash">
$ x=5
$ y="6"
$ z=abc
$ echo $(( $x + $y ))
11
$ echo $(( $x + $z ))
5
                                </pre>
                            </div>
                            <p>More examples:</p>
                            <pre class="brush:bash">
$ x=1
$ y=fred
$ echo $x$y
1fred
$ echo $xy        # the aim is to display "1y"

$ echo "$x"y
1y
$ echo ${x}y
1y
$ echo ${j-10}    # give value of j or 10 if no value
10
$ echo ${j=33}    # set j to 33 if no value (and give $j)
33
$ echo ${x:?No Value}   # display "No Value" if $x not set
1
$ echo ${xx:?No Value}  # display "No Value" if $xx not set
-bash: xx: No Value
                            </pre>
                        </div>
                        <div class="row">
                            <h4>Some built in shell variables</h4>
                            <ul>
                                <li><code>$0</code> - The name of the thing being run (command/script).</li>
                                <li><code>$1</code> - The first command-line argument.</li>
                                <li><code>$2</code> - The second command-line argument.</li>
                                <li><code>$3</code> - The third command-line argument.</li>
                                <li><code>$#</code> - Count of command-line arguments.</li>
                                <li><code>$*</code> - All of the command-line arguments (together).</li>
                                <li><code>$@</code> - All of the command-line arguments (separately).</li>
                                <li><code>$?</code> - Exit status of the most recent command.</li>
                                <li><code>$$</code> - Process ID of this shell.</li>
                            </ul>
                        </div>
                    </div>


                    <div class="row">
                        <h3>Quoting in all its varieties</h3>
                        <hr>
                        <p>Quoting can be used for three purposes in the shell:</p>
                        <ul>
                             <li>To group a sequence of words into a single "word".</li>
                             <li>To control the kinds of transformations that are performed.</li>
                             <li>To capture the output of commands (back-quotes).</li>
                        </ul>
                        <p>The three different types of quotes result in different things happening:</p>
                        <ul>
                            <li>Single Quote - <code>'</code> - Stops any variables inside the quotes from being treated as variables, $name would be printed instead of its contents.</li>
                            <li>Double Quote - <code>"</code> - Allows variables inside the quotes to be substitutes for their contents.</li>
                            <li>Back Quote - <code>`</code> - Will execute the text in the quotes as commands and then return the output.</li>
                        </ul>
                        <p>Back Quotes are very useful and it's useful to know how they are treated by the shell:</p>
                        <ol>
                            <li>Performs variable-substitution (as for double-quotes).</li>
                            <li>Executes the resulting command and arguments.</li>
                            <li>Captures the standard output from the command.</li>
                            <li>Converts it to a single string.</li>
                            <li>Uses this string as the value of the expression.</li>
                        </ol>
                    </div>

                    <div class="row">
                        <h3><code>eval</code></h3>
                        <hr>
                        <p>This is just a quick little bit on a very useful command called <code>eval</code>. <code>eval</code> allows use to perform mathematical operations in the shell and then return the result as a string.</p>
                        <p>
                            So using our handy back quotes we just learned out above we can assign a variable to be some value defined by a mathematical operation of two other variables. Like so:
                            <pre class="brush:bash">
$ a=3
$ b=30
$ sum=`expr $a + $b`
$ echo $sum
33
                            </pre>
                    </div>

                    <div class="row">
                        <h3><code>if</code>, <code>while</code>, <code>for</code></h3>
                        <hr>

                        <h4><code>test</code></h4>
                        <p>Before we can go into flow control, which involves conditions and tests to decide <strong>how</strong> to control the flow of the program we must tackle one feature of shell, the <code>test</code> command.</p>
                        <p>
                            The <code>test</code> command performs a test or combination of tests and:
                            <ul>
                                <li>Returns a zero exit status if the test succeeds.</li>
                                <li>Returns a non-zero exit status if the test fails.</li>
                            </ul>
                            <code>test</code> has a variety of useful testing options:
                            <ul>
                                <li>String comparison - ( =  != )</li>
                                <li>Numeric comparison - ( -eq  -ne  -lt )</li>
                                <li>Checks on files - ( -f  -x  -r )</li>
                                <li>Boolean operators - ( -a  -o  ! )</li>
                            </ul>
                            Here are some examples of how <code>test</code> can be used:
                        </p>
                        <pre class="brush:bash">
test "$msg" = "Hello"
    # does the variable msg have the value "Hello"?

test "$x" -gt "$y"
    # does x contain a numeric value larger than y?

msg="hello there"
test $msg = Hello
    # Error: expands to "test hello there = Hello"?

test "$x" -ge 10 -a "$x" -le 20
    # is the value of x in range 10..20?

test -r xyz -a -d xyz
    # is the file xyz a readable directory?
[ -r xyz -a -d xyz ]
    # alternative syntax; requires closing ]
                        </pre>
                        <br>
                        <h4><code>if</code></h4>
                        <p>Now onto some flow control, like most other languages have. Hopefully you're familiar with if statements and looping. <code>if</code>'s being some test/condition then code executed based on the result. Loops being some test or condition deciding when to enter and exit loops.</p>
                        <p>The easiest way to get you used to loops and if's is to have a look at examples and how their syntax works.</p>
                        <pre class="brush:bash">
if tests
then
   commands
elif tests
then
   commands
else
   command
fi
                        </pre>
                        <p>
                            Important things to note:
                            <ul>
                                <li><code>test</code> is where you put you're conditions.</li>
                                <li>Make sure each keyword (<code>then</code>, <code>if</code>, etc) is on a new line.</li>
                                <li><code>elif</code> is just this languages <code>else if</code>, <code>elsif</code>, etc...</li>
                                <li><code>fi</code> this ends the if statement, like the closing <code>}</code> in C or going back one level of indentation in python.</li>
                            </ul>
                        </p>

                        <h4><code>while</code> and <code>for</code></h4>
                        <p>
                            Again here's the basic syntax for while and for loops:
                            <h5><code>while</code></h5>
                            <pre class="brush:bash">
while tests
do
   commands
done
                            </pre>
                            <h5><code>for</code></h5>
                            <pre class="brush:bash">
for var in wordList
do
   commands  # generally involving var
done
                            </pre>
                        </p>
                        <p>So <code>for</code> is the slightly more complicated loop as it loops through a list, each iteration loading the next item from the list into the variable specified where <code>var</code> is. Examples will make reveal how to go about using each loop.</p>

                        <div class="row">
                            <h4>Examples</h4>
                            <div class="col-md-6">
                                <pre class="brush:bash">
# Check the system status every ten minutes

while true
do
   uptime
   sleep 600
done
                                </pre>
                                <div class="brush:bash">
# Process files in $PWD, asking for confirmation

for file in *
do
   echo -n "Process $file? "
   read answer
   if test "$answer" = "y"
      process &lt; $file &gt;&gt; results
   fi
done
                                </div> 
                            </div>
                            <div class="col-md-6">
                                <pre class="brush:bash">
# Interactively prompt the user to process files

echo -n "Next file: "
while read filename
do
   process &lt; "$filename" &gt;&gt; results
   echo -n "Next file: "
done
                                </pre>
                                <div class="brush:bash">
# Compute sum of a list of numbers from command line

sum=0
for n in "$@"    # remember $@ is all of the command arguments
do
   sum=`expr $sum + "$n"`
done
                                </div> 
                            </div>
                        </div>
                    </div>

                </div>

            </div>

            <div class="row">
                <h2>Exercises</h2>
                <hr>

            </div>

            <div style="text-align: center">
                <a class="btn btn-lg btn-success" href="solutions.html">
                    Solutions
                    <i class="fa fa-arrow-right"></i>
                </a>
            </div>

            <!-- footer -->
            <footer>
                <div class="row">
                    <div class="col-lg-12">         
                        <p class="pull-right"><a href="#"><i class="fa fa-caret-up"></i> Back to top</a></p>
                        <p>Part of the <a href="http://cse.unsw.edu.au/">UNSW CSE</a> Summer Workshops, on behalf of <a href="http://www.compclub.com.au">CompClub</a>.</p>
                        <p>Workshop content written by <a href="http://cgi.cse.unsw.edu.au/~otan/">Oliver Tan</a>, <a href="http://cgi.cse.unsw.edu.au/~vanessau/">Vanessa Ung</a>, <a href="http://cgi.cse.unsw.edu.au/~lpickup">Lucas Pickup</a> and <a href="http://cgi.cse.unsw.edu.au/~jwis261">John Wiseheart</a>.</p>
                    </div>
                </div>
            </footer>

        </div> <!-- container -->

        <script src="./assets/js/jquery.js"></script>
        <script src="./assets/js/bootstrap.min.js"></script>
        <script src="./assets/js/shCore.js"></script>
        <script src="./assets/js/shBrushBash.js"></script>
        <script type="text/javascript">SyntaxHighlighter.all();</script>
    </body>
</html>


